# 1. 转置卷积

## 1.1 计算方式

![image-20230909214235784](C:\Users\Tyrant\AppData\Roaming\Typora\typora-user-images\image-20230909214235784.png)

## 1.2 普通卷积的另一种计算方式

1. 普通卷积计算

![image-20230909214554588](C:\Users\Tyrant\AppData\Roaming\Typora\typora-user-images\image-20230909214554588.png)

2. 将输入矩阵展平

![image-20230909214703170](C:\Users\Tyrant\AppData\Roaming\Typora\typora-user-images\image-20230909214703170.png)

3. 将等效矩阵展平拼接

![image-20230909214739373](C:\Users\Tyrant\AppData\Roaming\Typora\typora-user-images\image-20230909214739373.png)

4. 计算

![image-20230909214809320](C:\Users\Tyrant\AppData\Roaming\Typora\typora-user-images\image-20230909214809320.png)

## 1.3 转置卷积

1. 用结果乘以C的转置，得到P

![image-20230909215421249](C:\Users\Tyrant\AppData\Roaming\Typora\typora-user-images\image-20230909215421249.png)

2. 将C转置还原

![image-20230909215545806](C:\Users\Tyrant\AppData\Roaming\Typora\typora-user-images\image-20230909215545806.png)

3. 乘以相应位置的值 == 转置卷积乘以原来的结果

![image-20230909215713363](C:\Users\Tyrant\AppData\Roaming\Typora\typora-user-images\image-20230909215713363.png)

## 1.4 总结

**原理：**（卷积的展开效果 == 转置矩阵）

1. 输入矩阵 * (展开)普通卷积C   = 输出矩阵
2. 输出矩阵 * 转置矩阵C‘ = P
3. 输出矩阵 * 展开普通卷积C’ = P

所以从中可以看出，展开的普通卷积 等价于 普通卷积的转置卷积

**转置卷积的作用：**

	1. 将低分辨率图像恢复到高分辨率
	1. 增加特征图的尺寸，方便对图像进行处理

**计算方式：**

输出 = (H - 1) * s - 2 * p + k 

这里的H为输入， s、p、k皆为原卷积的数据。

# 2.FCN(全卷积网络)

1. **全卷积网络结构**：FCN将传统的CNN结构中的全连接层（fully connected layers）替换为全卷积层（fully convolutional layers），这允许输入图像可以是任意大小。全卷积层使用卷积操作来生成特征图，然后通过上采样（通常是反卷积操作）将特征图的大小调整为输入图像的大小，从而获得像素级别的预测。
2. **池化层的替代**：FCN通常使用转置卷积（transpose convolution）或双线性插值等技术来执行上采样，以恢复分辨率。这避免了池化层的使用，因为池化层会导致分辨率丧失，而分割任务需要保留更多的空间信息。
3. **多尺度信息**：FCN通常包括多个卷积层，以捕获不同尺度的特征信息。通过合并这些不同尺度的特征图，FCN可以更好地处理不同大小的对象或物体。
4. **跳跃连接**：为了更好地保留细节信息，FCN引入了跳跃连接（skip connections），这些连接将低级别的特征与高级别的特征相结合。这有助于改善分割结果的细节和准确性。

![image-20230910204905796](C:\Users\Tyrant\AppData\Roaming\Typora\typora-user-images\image-20230910204905796.png)

![image-20230910205156637](C:\Users\Tyrant\AppData\Roaming\Typora\typora-user-images\image-20230910205156637.png)![image-20230910205210483](C:\Users\Tyrant\AppData\Roaming\Typora\typora-user-images\image-20230910205210483.png)

**注：**在上面的网络中，相加都为对应位置相加，后面的上采样都是采用转置卷积来进行扩大，然后最后恢复到原来的输入大小。

## 代码实现：

## SegmentationPresetTrain:

![image-20230911170855385](C:\Users\Tyrant\AppData\Roaming\Typora\typora-user-images\image-20230911170855385.png)

## get_transform

![image-20230911171107806](C:\Users\Tyrant\AppData\Roaming\Typora\typora-user-images\image-20230911171107806.png)

## create_model

![image-20230912191718837](C:\Users\Tyrant\AppData\Roaming\Typora\typora-user-images\image-20230912191718837.png)

## train_one_epoch

![image-20230912194427090](C:\Users\Tyrant\AppData\Roaming\Typora\typora-user-images\image-20230912194427090.png)

## evaluate

![image-20230912195123483](C:\Users\Tyrant\AppData\Roaming\Typora\typora-user-images\image-20230912195123483.png)

## train.py	![image-20230912192026700](C:\Users\Tyrant\AppData\Roaming\Typora\typora-user-images\image-20230912192026700.png)

![image-20230912193008548](C:\Users\Tyrant\AppData\Roaming\Typora\typora-user-images\image-20230912193008548.png)

## predict.py

![image-20230912200620850](C:\Users\Tyrant\AppData\Roaming\Typora\typora-user-images\image-20230912200620850.png)

## backbone.py

![image-20230912203723853](C:\Users\Tyrant\AppData\Roaming\Typora\typora-user-images\image-20230912203723853.png)

## fcn_model.py

![image-20230912210400022](C:\Users\Tyrant\AppData\Roaming\Typora\typora-user-images\image-20230912210400022.png)

![image-20230912210703980](C:\Users\Tyrant\AppData\Roaming\Typora\typora-user-images\image-20230912210703980.png)

![image-20230912211002362](C:\Users\Tyrant\AppData\Roaming\Typora\typora-user-images\image-20230912211002362.png)

## my_dataset.py

![image-20230913105256543](C:\Users\Tyrant\AppData\Roaming\Typora\typora-user-images\image-20230913105256543.png)

## 混淆矩阵的计算：

![image-20230913113053073](C:\Users\Tyrant\AppData\Roaming\Typora\typora-user-images\image-20230913113053073.png)

# 3.Deep Lab

**语义分割存在问题：**图像分辨率降低（通过使用其它特殊卷积），空间不敏感（CRF）。

## Deep V1

![image-20230911104214591](C:\Users\Tyrant\AppData\Roaming\Typora\typora-user-images\image-20230911104214591.png)

![image-20230911104735234](C:\Users\Tyrant\AppData\Roaming\Typora\typora-user-images\image-20230911104735234.png)

DeepLab-MSc-LargeFOV

![image-20230911105325392](C:\Users\Tyrant\AppData\Roaming\Typora\typora-user-images\image-20230911105325392.png)

## Deep V2

DCNNs应用在语义分割的问题：分辨率降低（膨胀），多尺寸问题（ASPP），降低定位精准性。

![image-20230911111428415](C:\Users\Tyrant\AppData\Roaming\Typora\typora-user-images\image-20230911111428415.png)![image-20230911112605899](C:\Users\Tyrant\AppData\Roaming\Typora\typora-user-images\image-20230911112605899.png)

### ASPP结构

![image-20230911112044988](C:\Users\Tyrant\AppData\Roaming\Typora\typora-user-images\image-20230911112044988.png)![image-20230911112157397](C:\Users\Tyrant\AppData\Roaming\Typora\typora-user-images\image-20230911112157397.png)

## Deep V3

### 两种结构

![image-20230911115211854](C:\Users\Tyrant\AppData\Roaming\Typora\typora-user-images\image-20230911115211854.png)

![image-20230911115533195](C:\Users\Tyrant\AppData\Roaming\Typora\typora-user-images\image-20230911115533195.png)

![image-20230911114515527](C:\Users\Tyrant\AppData\Roaming\Typora\typora-user-images\image-20230911114515527.png)

## 代码复现：

### 学习率：

![image-20230913160028854](C:\Users\Tyrant\AppData\Roaming\Typora\typora-user-images\image-20230913160028854.png)

### ASPP结构：

![image-20230913161833953](C:\Users\Tyrant\AppData\Roaming\Typora\typora-user-images\image-20230913161833953.png)

### 主分支：

![image-20230913162124320](C:\Users\Tyrant\AppData\Roaming\Typora\typora-user-images\image-20230913162124320.png)

### 完整流程：

![image-20230913162522596](C:\Users\Tyrant\AppData\Roaming\Typora\typora-user-images\image-20230913162522596.png)

# 4.LR-ASPP

![image-20230911160340242](C:\Users\Tyrant\AppData\Roaming\Typora\typora-user-images\image-20230911160340242.png)

![image-20230911160740511](C:\Users\Tyrant\AppData\Roaming\Typora\typora-user-images\image-20230911160740511.png)

![image-20230911160819767](C:\Users\Tyrant\AppData\Roaming\Typora\typora-user-images\image-20230911160819767.png)

##  代码复现

### Backone:

![image-20230913165718903](C:\Users\Tyrant\AppData\Roaming\Typora\typora-user-images\image-20230913165718903.png)

### LRASPPHead:

![image-20230913170115324](C:\Users\Tyrant\AppData\Roaming\Typora\typora-user-images\image-20230913170115324.png)

### 完整流程：

![image-20230913170349632](C:\Users\Tyrant\AppData\Roaming\Typora\typora-user-images\image-20230913170349632.png)

# 5. Unet

## 网络结构

![image-20230914100214343](C:\Users\Tyrant\AppData\Roaming\Typora\typora-user-images\image-20230914100214343.png)

![image-20230914100238051](C:\Users\Tyrant\AppData\Roaming\Typora\typora-user-images\image-20230914100238051.png)

## 代码复现

### 下采样

![image-20230914103017688](C:\Users\Tyrant\AppData\Roaming\Typora\typora-user-images\image-20230914103017688.png)

### 上采样

![image-20230914104527153](C:\Users\Tyrant\AppData\Roaming\Typora\typora-user-images\image-20230914104527153.png)

### 整体流程

![image-20230914111847677](C:\Users\Tyrant\AppData\Roaming\Typora\typora-user-images\image-20230914111847677.png)

### 损失计算

数据编码：

![image-20230914144934244](C:\Users\Tyrant\AppData\Roaming\Typora\typora-user-images\image-20230914144934244.png)![image-20230914145907356](C:\Users\Tyrant\AppData\Roaming\Typora\typora-user-images\image-20230914145907356.png)

计算公式：

![image-20230914134921989](C:\Users\Tyrant\AppData\Roaming\Typora\typora-user-images\image-20230914134921989.png)

预测的： ![image-20230914140003807](C:\Users\Tyrant\AppData\Roaming\Typora\typora-user-images\image-20230914140003807.png)



# 6.U2Net

## 网络结构

![image-20230914100552555](C:\Users\Tyrant\AppData\Roaming\Typora\typora-user-images\image-20230914100552555.png)

![image-20230914100646850](C:\Users\Tyrant\AppData\Roaming\Typora\typora-user-images\image-20230914100646850.png)![image-20230914100713754](C:\Users\Tyrant\AppData\Roaming\Typora\typora-user-images\image-20230914100713754.png)

![image-20230914100931253](C:\Users\Tyrant\AppData\Roaming\Typora\typora-user-images\image-20230914100931253.png)

## 损失计算

![image-20230914101243290](C:\Users\Tyrant\AppData\Roaming\Typora\typora-user-images\image-20230914101243290.png)

## 评价指标

![image-20230914101704433](C:\Users\Tyrant\AppData\Roaming\Typora\typora-user-images\image-20230914101704433.png)

## 代码

### 局部实现

![image-20230915202323479](C:\Users\Tyrant\AppData\Roaming\Typora\typora-user-images\image-20230915202323479.png)

![image-20230915203052782](C:\Users\Tyrant\AppData\Roaming\Typora\typora-user-images\image-20230915203052782.png)![image-20230915203842109](C:\Users\Tyrant\AppData\Roaming\Typora\typora-user-images\image-20230915203842109.png)

### 全部流程

![image-20230915204810381](C:\Users\Tyrant\AppData\Roaming\Typora\typora-user-images\image-20230915204810381.png)

![image-20230915205922946](C:\Users\Tyrant\AppData\Roaming\Typora\typora-user-images\image-20230915205922946.png)

![image-20230915210454801](C:\Users\Tyrant\AppData\Roaming\Typora\typora-user-images\image-20230915210454801.png)

![image-20230915210603116](C:\Users\Tyrant\AppData\Roaming\Typora\typora-user-images\image-20230915210603116.png)